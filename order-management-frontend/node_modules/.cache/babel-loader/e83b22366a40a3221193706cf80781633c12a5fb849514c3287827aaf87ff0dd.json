{"ast":null,"code":"var _jsxFileName = \"/Users/nshah/GPT Project/order-management-frontend/src/pages/EditPopup.js\",\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { fetchVendors, fetchProcesses, fetchLineItemProcesses, reorderLineItemProcesses, createLineItemProcess, deleteLineItemProcess, fetchAllVendorProcesses } from '../services/api';\nimport { DndContext, closestCenter } from '@dnd-kit/core';\nimport { arrayMove, SortableContext, useSortable, sortableKeyboardCoordinates, verticalListSortingStrategy } from '@dnd-kit/sortable';\nimport { KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';\nimport { CSS } from '@dnd-kit/utilities';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EditPopup = ({\n  lineItem,\n  onClose,\n  onSave\n}) => {\n  _s2();\n  var _s = $RefreshSig$();\n  const [vendors, setVendors] = useState([]); // Vendor list\n  const [processes, setProcesses] = useState([]); // Process list\n  const [vendorProcesses, setVendorProcesses] = useState([]); // Vendor-Process relationships\n  const [lineItemProcesses, setLineItemProcesses] = useState([]); // Existing LineItemProcesses\n  const [newProcess, setNewProcess] = useState({\n    processId: '',\n    vendorId: ''\n  });\n  const [draggedProcess, setDraggedProcess] = useState(null);\n  const [filteredVendors, setFilteredVendors] = useState([]); // Vendors filtered by process\n  const [filteredProcesses, setFilteredProcesses] = useState([]); // Processes filtered by vendor\n\n  useEffect(() => {\n    // Fetch initial data for vendors, processes, and line item processes\n    const loadInitialData = async () => {\n      try {\n        const encodedLineItemId = encodeURIComponent(lineItem.lineItemId); // Encode lineItemId\n        console.log('editpopup: Encoded lineItemId:', encodedLineItemId);\n\n        // Fetch vendors\n        const vendorData = await fetchVendors();\n        console.log('editpopup: Fetched vendors:', vendorData);\n        setVendors(vendorData);\n\n        // Fetch processes\n        const processData = await fetchProcesses();\n        console.log('editpopup: Fetched processes:', processData);\n        setProcesses(processData);\n\n        // Fetch line item processes\n        const lineItemProcessData = await fetchLineItemProcesses(encodedLineItemId);\n        console.log('editpopup: Fetched line item processes:', lineItemProcessData);\n        const vendorProcessData = await fetchAllVendorProcesses(); // Fetch mapping\n        console.log('editpopup: Fetched vendorProcesses:', vendorProcessData);\n        // Log each item in lineItemProcessData\n        lineItemProcessData.forEach((item, index) => {\n          console.log(`editpopup: Line item process ${index}:`, item);\n          console.log(`editpopup: Line item process ${index} _id:`, item._id);\n        });\n        setLineItemProcesses(lineItemProcessData.map((process, index) => ({\n          ...process,\n          customId: `${process.lineItemId}/${process.vendorId}/${process.processId}/${process.sequence}`\n        })));\n        setVendorProcesses(vendorProcessData);\n      } catch (err) {\n        console.error('editpopup: Error loading initial data:', err.message);\n      }\n    };\n    if (lineItem.lineItemId) {\n      loadInitialData(); // Fetch data if lineItemId is available\n    }\n  }, [lineItem.lineItemId]);\n  // Filter vendors based on selected process\n  useEffect(() => {\n    console.log('Filtering vendors for processId:', newProcess.processId);\n    console.log('Current Vendor-Process mappings:', vendorProcesses);\n    console.log('Current Vendors:', vendors);\n    if (newProcess.processId) {\n      const allowedVendors = vendorProcesses.filter(vp => vp.processId === newProcess.processId).map(vp => vp.vendorId);\n      console.log('Allowed Vendors:', allowedVendors);\n      const updatedVendors = vendors.filter(v => allowedVendors.includes(v.vendorId));\n      console.log('Filtered Vendors:', updatedVendors);\n      setFilteredVendors(updatedVendors);\n    } else {\n      setFilteredVendors(vendors);\n    }\n  }, [newProcess.processId, vendors, vendorProcesses]);\n  useEffect(() => {\n    if (newProcess.vendorId) {\n      console.log('Filtering processes for vendorId:', newProcess.vendorId);\n      const allowedProcesses = vendorProcesses.filter(vp => vp.vendorId === newProcess.vendorId).map(vp => vp.processId);\n      console.log('Allowed Processes:', allowedProcesses);\n      setFilteredProcesses(processes.filter(p => allowedProcesses.includes(p.processId)));\n    } else {\n      setFilteredProcesses(processes);\n    }\n  }, [newProcess.vendorId, processes, vendorProcesses]);\n\n  // Sensors for drag-and-drop\n  const sensors = useSensors(useSensor(PointerSensor), useSensor(KeyboardSensor, {\n    coordinateGetter: sortableKeyboardCoordinates\n  }));\n\n  // Sortable item component\n  const SortableItem = ({\n    id,\n    process\n  }) => {\n    _s();\n    id = process.customId; // Ensure id uses customId  \n    //console.log('SortableItem props:', { id, process });\n\n    const {\n      attributes,\n      listeners,\n      setNodeRef,\n      transform,\n      transition\n    } = useSortable({\n      id: id\n    });\n    if (!id || !process) {\n      console.error('SortableItem received undefined id or process:', {\n        id,\n        process\n      });\n      return null;\n    }\n    const handleRemove = async e => {\n      e.stopPropagation(); // Prevent drag event from triggering\n      try {\n        // Make sure we have both IDs\n        if (!lineItem.lineItemId || !process._id) {\n          console.error('Missing required IDs for deletion');\n          return;\n        }\n        console.log('Removing process:', {\n          lineItemId: lineItem.lineItemId,\n          processId: process.customId\n        });\n\n        // Call delete API with the correct IDs\n        await deleteLineItemProcess(lineItem.lineItemId, process.customId);\n\n        // Update state after successful deletion\n        setLineItemProcesses(prev => prev.filter(item => item.customId !== process.customId));\n      } catch (err) {\n        console.error('Error removing process:', err);\n      }\n    };\n    const style = {\n      transform: CSS.Transform.toString(transform),\n      transition,\n      padding: '10px',\n      margin: '5px 0',\n      background: '#f8f8f8',\n      border: '1px solid #ddd',\n      borderRadius: '4px',\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center'\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: setNodeRef,\n      style: style,\n      ...attributes,\n      ...listeners,\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: [\"Sequence: \", process.sequence, \", Process: \", process.processId, \", Vendor: \", process.vendorId]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleRemove,\n        style: {\n          marginLeft: '10px',\n          color: 'red',\n          border: 'none',\n          background: 'none',\n          cursor: 'pointer'\n        },\n        children: \"Remove\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }, this);\n  };\n  _s(SortableItem, \"FTUh0JV0KNM2MI3tYtLrQh0rr1U=\", false, function () {\n    return [useSortable];\n  });\n  const handleDragEnd = event => {\n    if (!event || !event.active || !event.over) {\n      console.warn('handleDragEnd: Missing active or over:', event);\n      return;\n    }\n    const {\n      active,\n      over\n    } = event;\n    if (!active.id || !over.id) {\n      console.warn('handleDragEnd: Missing ID in active or over:', {\n        active,\n        over\n      });\n      return;\n    }\n    console.log(`handleDragEnd: Moving ${active.id} over ${over.id}`);\n    setLineItemProcesses(items => {\n      const oldIndex = items.findIndex(item => item.customId === active.id);\n      const newIndex = items.findIndex(item => item.customId === over.id);\n      if (oldIndex === -1 || newIndex === -1) {\n        console.warn('handleDragEnd: Invalid indices:', {\n          oldIndex,\n          newIndex\n        });\n        return items;\n      }\n      const updatedItems = arrayMove(items, oldIndex, newIndex);\n      return updatedItems.map((item, index) => ({\n        ...item,\n        sequence: index + 1,\n        customId: `${item.lineItemId}/${item.vendorId}/${item.processId}/${index + 1}`\n      }));\n    });\n  };\n  const handleAddProcess = async () => {\n    if (!newProcess.processId || !newProcess.vendorId) {\n      console.warn('editpopup: Please select both a process and a vendor before adding.');\n      return;\n    }\n    try {\n      // Generate sequence number based on current processes count\n      const newSequence = lineItemProcesses.length + 1;\n\n      // Create a unique custom ID\n      const newCustomId = `${lineItem.lineItemId}/${newProcess.vendorId}/${newProcess.processId}/${newSequence}`;\n\n      // Check if the same process already exists\n      const isDuplicate = lineItemProcesses.some(item => item.customId === newCustomId);\n      if (isDuplicate) {\n        console.warn(`editpopup: Process with ID ${newCustomId} already exists.`);\n        return;\n      }\n      const newEntry = {\n        lineItemId: lineItem.lineItemId,\n        processId: newProcess.processId,\n        vendorId: newProcess.vendorId,\n        sequence: newSequence,\n        customId: newCustomId\n      };\n      console.log('editpopup: Sending new process to backend:', newEntry);\n\n      // Save to backend and capture response\n      const response = await createLineItemProcess(newEntry);\n      if (!response || response.error) {\n        console.error('editpopup: Backend error:', (response === null || response === void 0 ? void 0 : response.error) || 'Unknown error');\n        return;\n      }\n      console.log('editpopup: Process successfully added:', response);\n\n      // Fetch latest processes instead of appending manually (prevents stale data issues)\n      const updatedProcesses = await fetchLineItemProcesses(encodeURIComponent(lineItem.lineItemId));\n\n      // Update state with the newly fetched list\n      setLineItemProcesses(updatedProcesses.map((process, index) => ({\n        ...process,\n        sequence: index + 1,\n        // Ensure correct sequence\n        customId: `${process.lineItemId}/${process.vendorId}/${process.processId}/${index + 1}`\n      })));\n      console.log('editpopup: Updated lineItemProcesses after addition:', updatedProcesses);\n\n      // Reset form input\n      setNewProcess({\n        processId: '',\n        vendorId: ''\n      });\n    } catch (err) {\n      console.error('editpopup: Error adding new process:', err);\n    }\n  };\n  const handleSave = async () => {\n    try {\n      const encodedLineItemId = encodeURIComponent(lineItem.lineItemId); // Encode lineItemId\n      console.log(`editpopup: Encoded lineItemId for save: ${encodedLineItemId}`);\n\n      // Save reordered processes to backend\n      const reorderedProcessesPayload = lineItemProcesses.map(process => ({\n        lineItemProcessId: process._id,\n        // Ensure this matches the backend field\n        sequence: process.sequence\n      }));\n      await reorderLineItemProcesses(encodedLineItemId, reorderedProcessesPayload);\n      console.log('editpopup: Saved reordered processes:', lineItemProcesses);\n\n      // Refetch updated processes to ensure the latest data is shown\n      const updatedProcesses = await fetchLineItemProcesses(encodedLineItemId);\n      setLineItemProcesses(updatedProcesses.map((process, index) => {\n        var _process$_id;\n        return {\n          ...process,\n          _id: ((_process$_id = process._id) === null || _process$_id === void 0 ? void 0 : _process$_id.$oid) || `process-${index}` // Extract the $oid property if it exists\n        };\n      }));\n      const processIds = updatedProcesses.map(item => item.processId);\n      const vendorIds = updatedProcesses.map(item => item.vendorId);\n      console.log('Saving with:', {\n        processIds,\n        vendorIds,\n        lineItemProcesses\n      });\n      onSave({\n        ...lineItem,\n        processIds,\n        vendorIds,\n        lineItemProcesses: updatedProcesses\n      });\n    } catch (err) {\n      console.error('editpopup: Error saving processes:', err.message);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"popup\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"popup-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Edit Line Item\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DndContext, {\n        sensors: sensors,\n        collisionDetection: closestCenter,\n        onDragEnd: handleDragEnd,\n        children: /*#__PURE__*/_jsxDEV(SortableContext, {\n          items: lineItemProcesses.map(process => process.customId),\n          strategy: verticalListSortingStrategy,\n          children: lineItemProcesses.map(process => {\n            const id = process.customId;\n            const validProcess = process && id;\n            return validProcess ? /*#__PURE__*/_jsxDEV(SortableItem, {\n              id: id,\n              process: process // Pass the entire process object\n            }, id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 17\n            }, this) : null;\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Add New Process\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: newProcess.processId,\n          onChange: e => setNewProcess(prev => ({\n            ...prev,\n            processId: e.target.value\n          })),\n          style: {\n            marginRight: '10px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"Select Process\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 13\n          }, this), filteredProcesses.map(process => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: process.processId,\n            children: process.processId\n          }, process.processId, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: newProcess.vendorId,\n          onChange: e => setNewProcess(prev => ({\n            ...prev,\n            vendorId: e.target.value\n          })),\n          style: {\n            marginRight: '10px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"Select Vendor\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 13\n          }, this), filteredVendors.map(vendor => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: vendor.vendorId,\n            children: vendor.vendorId\n          }, vendor.vendorId, false, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleAddProcess,\n          style: {\n            padding: '5px 10px',\n            background: 'blue',\n            color: 'white'\n          },\n          children: \"Add\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSave,\n          style: {\n            padding: '5px 10px',\n            background: 'green',\n            color: 'white'\n          },\n          children: \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          style: {\n            padding: '5px 10px',\n            background: 'red',\n            color: 'white'\n          },\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 319,\n    columnNumber: 5\n  }, this);\n};\n_s2(EditPopup, \"nq2X2pvmFDYB+STxMkOfgjsloVA=\", false, function () {\n  return [useSensors, useSensor, useSensor];\n});\n_c = EditPopup;\nexport default EditPopup;\nvar _c;\n$RefreshReg$(_c, \"EditPopup\");","map":{"version":3,"names":["React","useState","useEffect","fetchVendors","fetchProcesses","fetchLineItemProcesses","reorderLineItemProcesses","createLineItemProcess","deleteLineItemProcess","fetchAllVendorProcesses","DndContext","closestCenter","arrayMove","SortableContext","useSortable","sortableKeyboardCoordinates","verticalListSortingStrategy","KeyboardSensor","PointerSensor","useSensor","useSensors","CSS","jsxDEV","_jsxDEV","EditPopup","lineItem","onClose","onSave","_s2","_s","$RefreshSig$","vendors","setVendors","processes","setProcesses","vendorProcesses","setVendorProcesses","lineItemProcesses","setLineItemProcesses","newProcess","setNewProcess","processId","vendorId","draggedProcess","setDraggedProcess","filteredVendors","setFilteredVendors","filteredProcesses","setFilteredProcesses","loadInitialData","encodedLineItemId","encodeURIComponent","lineItemId","console","log","vendorData","processData","lineItemProcessData","vendorProcessData","forEach","item","index","_id","map","process","customId","sequence","err","error","message","allowedVendors","filter","vp","updatedVendors","v","includes","allowedProcesses","p","sensors","coordinateGetter","SortableItem","id","attributes","listeners","setNodeRef","transform","transition","handleRemove","e","stopPropagation","prev","style","Transform","toString","padding","margin","background","border","borderRadius","display","justifyContent","alignItems","ref","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","marginLeft","color","cursor","handleDragEnd","event","active","over","warn","items","oldIndex","findIndex","newIndex","updatedItems","handleAddProcess","newSequence","length","newCustomId","isDuplicate","some","newEntry","response","updatedProcesses","handleSave","reorderedProcessesPayload","lineItemProcessId","_process$_id","$oid","processIds","vendorIds","className","collisionDetection","onDragEnd","strategy","validProcess","marginTop","value","onChange","target","marginRight","vendor","_c","$RefreshReg$"],"sources":["/Users/nshah/GPT Project/order-management-frontend/src/pages/EditPopup.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { fetchVendors, fetchProcesses, fetchLineItemProcesses, reorderLineItemProcesses, createLineItemProcess, deleteLineItemProcess,fetchAllVendorProcesses } from '../services/api';\nimport { DndContext, closestCenter } from '@dnd-kit/core';\nimport {\n  arrayMove,\n  SortableContext,\n  useSortable,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable';\nimport { KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';\nimport { CSS } from '@dnd-kit/utilities';\n\nconst EditPopup = ({ lineItem, onClose, onSave }) => {\n  const [vendors, setVendors] = useState([]); // Vendor list\n  const [processes, setProcesses] = useState([]); // Process list\n  const [vendorProcesses, setVendorProcesses] = useState([]); // Vendor-Process relationships\n  const [lineItemProcesses, setLineItemProcesses] = useState([]); // Existing LineItemProcesses\n  const [newProcess, setNewProcess] = useState({ processId: '', vendorId: '' });\n  const [draggedProcess, setDraggedProcess] = useState(null);\n  const [filteredVendors, setFilteredVendors] = useState([]); // Vendors filtered by process\n  const [filteredProcesses, setFilteredProcesses] = useState([]); // Processes filtered by vendor\n\n  useEffect(() => {\n    // Fetch initial data for vendors, processes, and line item processes\n    const loadInitialData = async () => {\n      try {\n        const encodedLineItemId = encodeURIComponent(lineItem.lineItemId); // Encode lineItemId\n        console.log('editpopup: Encoded lineItemId:', encodedLineItemId);\n\n        // Fetch vendors\n        const vendorData = await fetchVendors();\n        console.log('editpopup: Fetched vendors:', vendorData);\n        setVendors(vendorData);\n\n        // Fetch processes\n        const processData = await fetchProcesses();\n        console.log('editpopup: Fetched processes:', processData);\n        setProcesses(processData);\n\n        // Fetch line item processes\n        const lineItemProcessData = await fetchLineItemProcesses(encodedLineItemId);\n        console.log('editpopup: Fetched line item processes:', lineItemProcessData);\n        const vendorProcessData = await fetchAllVendorProcesses(); // Fetch mapping\n        console.log('editpopup: Fetched vendorProcesses:', vendorProcessData);\n        // Log each item in lineItemProcessData\n        lineItemProcessData.forEach((item, index) => {\n          console.log(`editpopup: Line item process ${index}:`, item);\n          console.log(`editpopup: Line item process ${index} _id:`, item._id);\n        });\n\n        setLineItemProcesses(\n          lineItemProcessData.map((process, index) => ({\n            ...process,\n            customId: `${process.lineItemId}/${process.vendorId}/${process.processId}/${process.sequence}`,\n          }))\n        );\n        setVendorProcesses(vendorProcessData);\n      } catch (err) {\n        console.error('editpopup: Error loading initial data:', err.message);\n      }\n    };\n\n    if (lineItem.lineItemId) {\n      loadInitialData(); // Fetch data if lineItemId is available\n    }\n  }, [lineItem.lineItemId]);\n // Filter vendors based on selected process\n useEffect(() => {\n  console.log('Filtering vendors for processId:', newProcess.processId);\n  console.log('Current Vendor-Process mappings:', vendorProcesses);\n  console.log('Current Vendors:', vendors);\n\n  if (newProcess.processId) {\n    const allowedVendors = vendorProcesses\n      .filter(vp => vp.processId === newProcess.processId)\n      .map(vp => vp.vendorId);\n\n    console.log('Allowed Vendors:', allowedVendors);\n    const updatedVendors = vendors.filter(v => allowedVendors.includes(v.vendorId));\n    console.log('Filtered Vendors:', updatedVendors);\n    setFilteredVendors(updatedVendors);\n  } else {\n    setFilteredVendors(vendors);\n  }\n}, [newProcess.processId, vendors, vendorProcesses]);\n\nuseEffect(() => {\n  if (newProcess.vendorId) {\n    console.log('Filtering processes for vendorId:', newProcess.vendorId);\n    const allowedProcesses = vendorProcesses\n      .filter(vp => vp.vendorId === newProcess.vendorId)\n      .map(vp => vp.processId);\n\n    console.log('Allowed Processes:', allowedProcesses);\n    setFilteredProcesses(processes.filter(p => allowedProcesses.includes(p.processId)));\n  } else {\n    setFilteredProcesses(processes);\n  }\n}, [newProcess.vendorId, processes, vendorProcesses]);\n\n  // Sensors for drag-and-drop\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  // Sortable item component\n  const SortableItem = ({ id, process }) => {\n    id = process.customId; // Ensure id uses customId  \n    //console.log('SortableItem props:', { id, process });\n\n    const { attributes, listeners, setNodeRef, transform, transition } = useSortable({\n      id: id\n    });\n\n    if (!id || !process) {\n      console.error('SortableItem received undefined id or process:', { id, process });\n      return null;\n    }\n    \n\n    const handleRemove = async (e) => {\n      e.stopPropagation(); // Prevent drag event from triggering\n      try {\n        // Make sure we have both IDs\n        if (!lineItem.lineItemId || !process._id) {\n          console.error('Missing required IDs for deletion');\n          return;\n        }\n\n        console.log('Removing process:', {\n          lineItemId: lineItem.lineItemId,\n          processId: process.customId\n        });\n\n        // Call delete API with the correct IDs\n        await deleteLineItemProcess(lineItem.lineItemId, process.customId);\n\n        // Update state after successful deletion\n        setLineItemProcesses(prev =>\n          prev.filter(item => item.customId !== process.customId)\n        );\n      } catch (err) {\n        console.error('Error removing process:', err);\n      }\n    };\n\n    const style = {\n      transform: CSS.Transform.toString(transform),\n      transition,\n      padding: '10px',\n      margin: '5px 0',\n      background: '#f8f8f8',\n      border: '1px solid #ddd',\n      borderRadius: '4px',\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n    };\n\n    return (\n      <div ref={setNodeRef} style={style} {...attributes} {...listeners}>\n        <span>\n          Sequence: {process.sequence},\n          Process: {process.processId},\n          Vendor: {process.vendorId}\n        </span>\n        <button\n          onClick={handleRemove}\n          style={{\n            marginLeft: '10px',\n            color: 'red',\n            border: 'none',\n            background: 'none',\n            cursor: 'pointer',\n          }}\n        >\n          Remove\n        </button>\n      </div>\n    );\n  };\n\n  const handleDragEnd = (event) => {\n    if (!event || !event.active || !event.over) {\n      console.warn('handleDragEnd: Missing active or over:', event);\n      return;\n    }\n  \n    const { active, over } = event;\n  \n    if (!active.id || !over.id) {\n      console.warn('handleDragEnd: Missing ID in active or over:', { active, over });\n      return;\n    }\n  \n    console.log(`handleDragEnd: Moving ${active.id} over ${over.id}`);\n  \n    setLineItemProcesses((items) => {\n      const oldIndex = items.findIndex((item) => item.customId === active.id);\n      const newIndex = items.findIndex((item) => item.customId === over.id);\n      \n  \n      if (oldIndex === -1 || newIndex === -1) {\n        console.warn('handleDragEnd: Invalid indices:', { oldIndex, newIndex });\n        return items;\n      }\n  \n      const updatedItems = arrayMove(items, oldIndex, newIndex);\n  \n      return updatedItems.map((item, index) => ({\n        ...item,\n        sequence: index + 1,\n        customId: `${item.lineItemId}/${item.vendorId}/${item.processId}/${index + 1}`,\n      }));\n    });\n  };\n  \n\n  const handleAddProcess = async () => {\n    if (!newProcess.processId || !newProcess.vendorId) {\n      console.warn('editpopup: Please select both a process and a vendor before adding.');\n      return;\n    }\n  \n    try {\n      // Generate sequence number based on current processes count\n      const newSequence = lineItemProcesses.length + 1;\n  \n      // Create a unique custom ID\n      const newCustomId = `${lineItem.lineItemId}/${newProcess.vendorId}/${newProcess.processId}/${newSequence}`;\n  \n      // Check if the same process already exists\n      const isDuplicate = lineItemProcesses.some(item => item.customId === newCustomId);\n      if (isDuplicate) {\n        console.warn(`editpopup: Process with ID ${newCustomId} already exists.`);\n        return;\n      }\n  \n      const newEntry = {\n        lineItemId: lineItem.lineItemId,\n        processId: newProcess.processId,\n        vendorId: newProcess.vendorId,\n        sequence: newSequence,\n        customId: newCustomId,\n      };\n  \n      console.log('editpopup: Sending new process to backend:', newEntry);\n  \n      // Save to backend and capture response\n      const response = await createLineItemProcess(newEntry);\n  \n      if (!response || response.error) {\n        console.error('editpopup: Backend error:', response?.error || 'Unknown error');\n        return;\n      }\n  \n      console.log('editpopup: Process successfully added:', response);\n  \n      // Fetch latest processes instead of appending manually (prevents stale data issues)\n      const updatedProcesses = await fetchLineItemProcesses(encodeURIComponent(lineItem.lineItemId));\n  \n      // Update state with the newly fetched list\n      setLineItemProcesses(\n        updatedProcesses.map((process, index) => ({\n          ...process,\n          sequence: index + 1, // Ensure correct sequence\n          customId: `${process.lineItemId}/${process.vendorId}/${process.processId}/${index + 1}`,\n        }))\n      );\n  \n      console.log('editpopup: Updated lineItemProcesses after addition:', updatedProcesses);\n  \n      // Reset form input\n      setNewProcess({ processId: '', vendorId: '' });\n  \n    } catch (err) {\n      console.error('editpopup: Error adding new process:', err);\n    }\n  };\n  \n  const handleSave = async () => {\n    try {\n      const encodedLineItemId = encodeURIComponent(lineItem.lineItemId); // Encode lineItemId\n      console.log(`editpopup: Encoded lineItemId for save: ${encodedLineItemId}`);\n\n      // Save reordered processes to backend\n      const reorderedProcessesPayload = lineItemProcesses.map((process) => ({\n        lineItemProcessId: process._id, // Ensure this matches the backend field\n        sequence: process.sequence,\n      }));\n      await reorderLineItemProcesses(encodedLineItemId, reorderedProcessesPayload);\n\n      console.log('editpopup: Saved reordered processes:', lineItemProcesses);\n\n      // Refetch updated processes to ensure the latest data is shown\n      const updatedProcesses = await fetchLineItemProcesses(encodedLineItemId);\n      setLineItemProcesses(\n        updatedProcesses.map((process, index) => ({\n          ...process,\n          _id: process._id?.$oid || `process-${index}`, // Extract the $oid property if it exists\n        }))\n      );\n\n      const processIds = updatedProcesses.map((item) => item.processId);\n      const vendorIds = updatedProcesses.map((item) => item.vendorId);\n\n      console.log('Saving with:', { processIds, vendorIds, lineItemProcesses });\n      onSave({ ...lineItem, processIds, vendorIds, lineItemProcesses: updatedProcesses });\n    } catch (err) {\n      console.error('editpopup: Error saving processes:', err.message);\n    }\n  };\n\n  return (\n    <div className=\"popup\">\n      <div className=\"popup-content\">\n        <h2>Edit Line Item</h2>\n\n        <DndContext\n          sensors={sensors}\n          collisionDetection={closestCenter}\n          onDragEnd={handleDragEnd}\n        >\n          <SortableContext\n            items={lineItemProcesses.map(process => process.customId)}\n            strategy={verticalListSortingStrategy}\n          >\n            {lineItemProcesses.map((process) => {\n              const id = process.customId;\n              const validProcess = process && id;\n\n              return validProcess ? (\n                <SortableItem\n                  key={id}\n                  id={id}\n                  process={process} // Pass the entire process object\n                />\n              ) : null;\n            })}\n          </SortableContext>\n        </DndContext>\n\n        <div style={{ marginTop: '20px' }}>\n          <h3>Add New Process</h3>\n          <select\n            value={newProcess.processId}\n            onChange={(e) => setNewProcess((prev) => ({ ...prev, processId: e.target.value }))}\n            style={{ marginRight: '10px' }}\n          >\n            <option value=\"\">Select Process</option>\n            {filteredProcesses.map((process) => (\n              <option key={process.processId} value={process.processId}>\n                {process.processId}\n              </option>\n            ))}\n          </select>\n          <select\n            value={newProcess.vendorId}\n            onChange={(e) => setNewProcess((prev) => ({ ...prev, vendorId: e.target.value }))}\n            style={{ marginRight: '10px' }}\n          >\n            <option value=\"\">Select Vendor</option>\n            {filteredVendors.map((vendor) => (\n              <option key={vendor.vendorId} value={vendor.vendorId}>\n                {vendor.vendorId}\n              </option>\n            ))}\n          </select>\n          <button onClick={handleAddProcess} style={{ padding: '5px 10px', background: 'blue', color: 'white' }}>\n            Add\n          </button>\n        </div>\n\n        <div style={{ marginTop: '20px' }}>\n          <button onClick={handleSave} style={{ padding: '5px 10px', background: 'green', color: 'white' }}>\n            Save\n          </button>\n          <button onClick={onClose} style={{ padding: '5px 10px', background: 'red', color: 'white' }}>\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EditPopup;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}